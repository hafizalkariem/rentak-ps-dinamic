server {
    # Nginx akan mendengarkan di port yang diberikan oleh Railway melalui variabel lingkungan $PORT
    listen ${PORT} default_server;
    listen [::]:${PORT} default_server;

    # Root dokumen Nginx adalah folder public Laravel di dalam kontainer
    root /app/public;

    # Header keamanan dasar
    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-Content-Type-Options "nosniff";

    # File indeks yang akan dicari
    index index.php index.html index.htm;

    # Encoding karakter
    charset utf-8;

    # Aturan untuk menangani semua permintaan yang tidak langsung merujuk ke file statis
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Aturan untuk memproses file PHP menggunakan PHP-FPM
    location ~ \.php$ {
        # Meneruskan permintaan PHP ke PHP-FPM yang berjalan di kontainer yang sama (port 9000)
        fastcgi_pass 127.0.0.1:9000;
        fastcgi_index index.php;
        fastcgi_buffers 16 16k;
        fastcgi_buffer_size 32k;
        # Mengatur SCRIPT_FILENAME agar PHP-FPM tahu di mana script berada
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        # Sertakan parameter FastCGI standar
        include fastcgi_params;
    }

    # Mencegah akses ke file .ht* (misalnya .htaccess)
    location ~ /\.ht {
        deny all;
    }
}